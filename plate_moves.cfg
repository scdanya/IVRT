[gcode_macro Move_forward]
gcode:
    {% set speed = params.SPEED|default(25) %}
    {% set syn = params.SYNC|default(0) %}
    {% set move = params.MOVE|default(220) %}
    {% set pump = params.STEPPER|default('plate') %}
    MANUAL_STEPPER STEPPER={pump} ENABLE=1 SPEED=25 SET_POSITION=0 MOVE={move} 
    M400
    MANUAL_STEPPER STEPPER={pump} ENABLE=0

[gcode_macro Move_back]
gcode:
  QUERY_ENDSTOPS
  {% set speed = params.SPEED|default(25) %}
  {% set syn = params.SYNC|default(0) %}
  {% set move = params.MOVE|default(-315) %}
  {% set pump = params.STEPPER|default('plate') %}
    MANUAL_STEPPER STEPPER={pump} ENABLE=1 SPEED=25 SET_POSITION=0 MOVE={move} STOP_ON_ENDSTOP=1
    M400
    MANUAL_STEPPER STEPPER={pump} ENABLE=0

[gcode_macro Move_test]
gcode:
  {% set speed = params.SPEED|default(25) %}
  {% set syn = params.SYNC|default(0) %}
  {% set purge_distance = params.MOVE|default(-2) %}
  {% set pump = params.STEPPER|default('plate') %}
    MANUAL_STEPPER STEPPER={pump} ENABLE=1
    MANUAL_STEPPER STEPPER={pump} MOVE={purge_distance} SPEED={speed} SYNC={syn} SET_POSITION=0 
    M400  
    MANUAL_STEPPER STEPPER={pump} ENABLE=0

[gcode_macro plate_home]
gcode:
    MANUAL_STEPPER STEPPER=plate ENABLE=1 SPEED=5 SET_POSITION=-320 MOVE=0 STOP_ON_ENDSTOP=1
    M400
    RESPOND PREFIX=tgalarm MSG="Крышка в верхнем положении"
    
[gcode_macro plate_down]
gcode:
  Move_plate move=-108
  M400
  RESPOND PREFIX=tgalarm MSG="Крышка в нижнем положении"

[gcode_macro Move_plate]
gcode: 
    {% set dist = params.MOVE|default(5) %}
      MANUAL_STEPPER STEPPER=plate SPEED=5 MOVE={dist} 
      M400
      Disable_pump_plate
    
[gcode_macro Enable_pump_plate]
gcode:
    {% set state = params.ENABLE|default(1) %}
    {% set pumps = ['plate'] %}
    {% for pump in pumps %}
        MANUAL_STEPPER STEPPER={pump} ENABLE={state}
    {% endfor %}

[gcode_macro Disable_pump_plate]
gcode: 
    {% set state = params.ENABLE|default(0) %}
    {% set pumps = ['plate'] %}
    {% for pump in pumps %}
        MANUAL_STEPPER STEPPER={pump} ENABLE={state}
    {% endfor %}